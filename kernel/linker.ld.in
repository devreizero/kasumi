OUTPUT_FORMAT(@TARGET_OUTPUT_FORMAT@)
ENTRY(kboot)

/* Generic linker script template */

@PROTOCOL_PREAMBLE@

SECTIONS {
    . = @LOAD_ADDRESS@;
    __kernelStart = .;

@PROTOCOL_EARLY_SECTIONS@

    .text.init : {
        *(.text.init)
    } :text

    . = ALIGN(CONSTANT(MAXPAGESIZE));

    .text : {
        *(.text*)
    } :text

@PROTOCOL_TEXT_SECTIONS@

    /* Move to the next memory page for .rodata */
    . = ALIGN(CONSTANT(MAXPAGESIZE));

    .rodata : {
        *(.rodata*)
    } :rodata

    /* Add a .note.gnu.build-id output section in case a build ID flag is added to the */
    /* linker command. */
    .note.gnu.build-id : {
        *(.note.gnu.build-id)
    } :rodata

@PROTOCOL_RODATA_SECTIONS@

    /* Move to the next memory page for .data */
    . = ALIGN(CONSTANT(MAXPAGESIZE));

    .data.init : {
        *(.data.init)
    } :data

    . = ALIGN(CONSTANT(MAXPAGESIZE));

    .data : {
        *(.data*)
    } :data

@PROTOCOL_DATA_SECTIONS@

    /* NOTE: .bss needs to be the last thing mapped to :data, otherwise lots of */
    /* unnecessary zeros will be written to the binary. */
    /* If you need, for example, .init_array and .fini_array, those should be placed */
    /* above this. */
    .bss : {
        *(.bss*)
        *(COMMON)
    } :data

    /* Bootloader protocol specific sections */
@PROTOCOL_FINAL_SECTIONS@

    /* Discard .note.* and .eh_frame* since they may cause issues on some hosts. */
    /DISCARD/ : {
        *(.eh_frame*)
        *(.note .note.*)
    }

    __kernelEnd = .;
}
